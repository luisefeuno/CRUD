<!-- <script src="../../public/lib/jquery/jquery.min.js"></script> -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ui/1.12.1/i18n/jquery-ui-i18n.min.js"></script> -->

<!-- <script src="../../public/lib/jquery-ui/ui/widgets/datepicker.js"></script> -->
<script src="../../public/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../../public/lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script src="../../public/lib/moment/min/moment.min.js"></script>
<script src="../../public/lib/peity/jquery.peity.min.js"></script>
<script src="../../public/lib/rickshaw/vendor/d3.min.js"></script>
<script src="../../public/lib/rickshaw/vendor/d3.layout.min.js"></script>
<script src="../../public/lib/rickshaw/rickshaw.min.js"></script>
<script src="../../public/lib/jquery.flot/jquery.flot.js"></script>
<script src="../../public/lib/jquery.flot/jquery.flot.resize.js"></script>
<script src="../../public/lib/flot-spline/js/jquery.flot.spline.min.js"></script>
<script src="../../public/lib/jquery-sparkline/jquery.sparkline.min.js"></script>
<script src="../../public/lib/echarts/echarts.min.js"></script>
<script src="../../public/lib/select2/js/select2.full.min.js"></script>
<!-- <script src="http://maps.google.com/maps/api/js?key=AIzaSyAq8o5-8Y5pudbJMJtDFzb8aHiWJufa5fg"></script> -->


<script src="../../public/lib/gmaps/gmaps.min.js"></script>
<script src="../../public/js/map.shiftworker.js"></script>
<script src="../../public/js/ResizeSensor.js"></script>
<script src="../../public/js/dashboard.js"></script>
<script src="../../public/lib/highlightjs/highlight.pack.min.js"></script>
<script src="../../public/lib/select2/js/select2.min.js"></script>

<script src="../../public/js/toastr.min.js"></script>

<!-- Para formatear las fechas, debe cargarse despu√©s de Jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.7/jquery.inputmask.min.js"></script>



<!-- sweetalert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- ************************************ -->

<!-- Necesario para los datatables - Incluido bootstrap y Jquery -->
<!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" -->
<!-- integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>

<!-- Para los botones de exportaci√≥n -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"
    integrity="sha384-+mbV2IY1Zk/X1p/nWllGySJSUN8uMs+gUAN10Or95UBH0fpj6GfKgPmgC5EXieXG"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"
    integrity="sha384-VFQrHzqBh5qiJIU0uGU5CIW3+OWpdGGJM9LBnGbuIH2mkICcFZ7lPd/AAtI7SNf7"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"
    integrity="sha384-/RlQG9uf0M2vcTw3CX7fbqgbj/h8wKxw7C3zu9/GxcBPRKOEcESxaxufwRXqzq6n"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.min.js"
    integrity="sha384-G85lmdZCo2WkHaZ8U1ZceHekzKcg37sFrs4St2+u/r2UtfvSDQmQrkMsEx4Cgv/W"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/buttons/3.2.2/js/dataTables.buttons.min.js"
    integrity="sha384-DmaAfo+/+UjRKHPidNNswlNqd9ybuE6yx9zKHyMY+vYy9SZhQEu4nauMVgwSx4Z/"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/buttons/3.2.2/js/buttons.bootstrap5.min.js"
    integrity="sha384-BdedgzbgcQH1hGtNWLD56fSa7LYUCzyRMuDzgr5+9etd1/W7eT0kHDrsADMmx60k"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/buttons/3.2.2/js/buttons.colVis.min.js"
    integrity="sha384-LC8PmH0Tdjy6c1Hesl75hUSKQuoIo3PCAr3svr0xJ4y90sNaTEMLK5n68Fl5VBqB"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/buttons/3.2.2/js/buttons.html5.min.js"
    integrity="sha384-+E6fb8f66UPOVDHKlEc1cfguF7DOTQQ70LNUnlbtywZiyoyQWqtrMjfTnWyBlN/Y"
    crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/buttons/3.2.2/js/buttons.print.min.js"
    integrity="sha384-FvTRywo5HrkPlBKFrm2tT8aKxIcI/VU819roC/K/8UrVwrl4XsF3RKRKiCAKWNly"
    crossorigin="anonymous"></script>

<!-- Para poder hacer agrupaciones de rows's -->
<script src="https://cdn.datatables.net/rowgroup/1.5.1/js/dataTables.rowGroup.min.js"></script>
<script src="https://cdn.datatables.net/rowgroup/1.5.1/js/rowGroup.dataTables.min.js"></script>


<script>
    /////////////////////////////////////
    // INICIO DE LA ESTRUCTURA COMUN   //
    ////////////////////////////////////
    // Extender las opciones por defecto de datatables
    $.extend(true, $.fn.dataTable.defaults, {
        autoWidth: false, // no ajustar el ancho de las columnas autom√°ticamente
        info: true, // ocultar informacion, bajo de la tabla
        paging: true, // ocultar paginacion, muestra todos los registros
        searching: true, // ocultar buscador
        ordering: true, // ocultar ordenamiento de las cabeceras
        stateSave: false, // guardar el estado de la tabla
        //scrollY: '50vh', // altura de la tabla
        scrollX: true, // ancho de la tabla
        scrollCollapse: true, // colapsar la tabla si no hay suficientes registros
        fixedHeader: true, // fijar el encabezado de la tabla
        responsive: true, // tabla responsiva
        layout: {
            topStart: {
                buttons: [
                    // { extend: 'copy', className: 'btn-copy btn btn-info ' },
                    {
                        extend: 'copyHtml5',
                        text: '<i class="fa-solid fa-copy"></i>',
                        titleAttr: 'Copy'

                    },
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fa-solid fa-file-excel"></i>',
                        titleAttr: 'Excel'

                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fa-solid fa-file-pdf"></i>',
                        titleAttr: 'PDF'

                    },
                    {
                        extend: 'print',
                        text: '<i class="fa-solid fa-print"></i>',
                        titleAttr: 'Print'

                    },
                    {
                        extend: 'spacer',
                        style: 'bar'
                    },
                    {
                        extend: 'colvis',
                        className: 'btn-visibility btn btn-info '
                    }
                ]
            }, // de la topStart
            topEnd: 'search', // que elementos de la paginaci√≥n queremos que aparezcan    
            bottomStart: 'info',
            bottomEnd: { // que elementos de la paginaci√≥n queremos que aparezcan
                paging: {
                    firstLast: true,
                    numbers: true,
                    previousNext: true
                } //
            } // de la bottomEnd

        }, // de layout
        language: {
            url: 'https://cdn.datatables.net/plug-ins/2.2.2/i18n/es-ES.json',
        }, //https://datatables.net/plug-ins/i18n/Spanish.html
        lengthMenu: [
            [3, 10, 30, 50, 100, -1],
            [3, 10, 30, 50, 100, 'TODOS']
        ], // cantidad de registros a mostrar, el primero son los valores y el segundo el texto a mostrar 
    });
    /////////////////////////////////////
    // FIN DE LA ESTRUCTURA COMUN   //
    ///////////////////////////////////


    /* ************************************ */
    /* ******* FUNCIONES APOYO    ******** */
    /* *******     NO TOCAR      ******** */
    /* ********************************** */

    // funciones para NO TOCAR son de apoyo al render del datatables.
    // Funci√≥n para limpiar el valor de una celda de la tabla de empleados <<<---- ES UN EJEMPLO NO SE UTILIZA
    function limpiarMoneda(valor) {
        // Eliminar el s√≠mbolo "‚Ç¨" y reemplazar la coma por un punto (para formato decimal correcto)
        return parseFloat(valor.replace('‚Ç¨', '').replace(',', '.'));
    }

    // Funci√≥n para dar formato europeo a una fecha y hora
    function formatoFechaEuropeo(fechaAmericana) {
        if (!fechaAmericana) return ""; // Si la fecha est√° vac√≠a, devuelve una cadena vac√≠a

        const [fecha, hora] = fechaAmericana.split(" "); // Separamos fecha y hora
        const [year, month, day] = fecha.split("-"); // Separamos la parte de la fecha

        return `${day}-${month}-${year} ${hora || ""}`.trim(); // Formato europeo
    }
    // üîπ Ejemplo de uso:
    //    console.log(formatoFechaEuropeo("2025-02-26 14:30:15")); // Salida: 26-02-2025 14:30:15
    //    console.log(formatoFechaEuropeo("2025-02-26")); // Salida: 26-02-2025

    ////////////////////////////////////////////
    //   FIN DE ZONA FUNCIONES DE APOYO      //
    //////////////////////////////////////////
</script>


<script>
    // Configura el datepicker en espa√±ol
    $.datepicker.regional['es'] = {
        closeText: 'Cerrar',
        prevText: 'Anterior',
        nextText: 'Siguiente',
        currentText: 'Hoy',
        monthNames: ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
            'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
        ],
        monthNamesShort: ['ene', 'feb', 'mar', 'abr', 'may', 'jun',
            'jul', 'ago', 'sep', 'oct', 'nov', 'dic'
        ],
        dayNames: ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'],
        dayNamesShort: ['dom', 'lun', 'mar', 'mi√©', 'jue', 'vie', 's√°b'],
        dayNamesMin: ['D', 'L', 'M', 'X', 'J', 'V', 'S'],
        weekHeader: 'Sm',
        dateFormat: 'dd-mm-yy',
        firstDay: 1,
        isRTL: false,
        showMonthAfterYear: false,
        yearSuffix: ''
    };
</script>



<script>
    ///////////////////////////////////
    // Se define la clase a aplicar //
    // Para la validacion de campos //
    ///////////////////////////////////

    class FormValidator {
        constructor(formId, fields) {
            this.form = document.getElementById(formId);
            //console.log("Contenido de formId:", this.form);
            this.fields = fields;

            //console.log("Contenido de fields:", this.fields);
            //  console.log(this.fields.nombre);
            //  console.log(this.fields.nombre.pattern);
            //  console.log(this.fields.email);
            //  console.log(this.fields.email.required);
            //Para acceder a cada propiedad se puede hacer: 
            //const pattern = this.fields.nombre.pattern


            this.initialize();
        }


        //Tiene cuatro metodos
        // initialize(): Configura los event listeners
        // validateForm(): Valida todos los campos al enviar
        // validateField(): Valida un campo individual usando regex
        // clearValidation(): Limpia los estados de validaci√≥n


        /////////////////////////////////////////////
        //         METODO : INICIALICE            //
        //    Configura los events listeners      //
        ////////////////////////////////////////////
        initialize() {
            // recogemos el evento de la captura del formulario
            // ejecuta el validateForm(e) cuando se hace click en el submit.
            this.form.addEventListener('submit', (e) => this.validateForm(e));

            // Este punto trabaja sobre cada campo del formulario y trabaja seg√∫n cada tecla apretada
            // actua en tiempo real sobre el formulario
            //Esta linea obtiene los nombres de los campos del formulario ('nombre', 'email', 'telefono', el name del input)
            Object.keys(this.fields).forEach(field => {
                //Selecciona cada elemento del DOM usando la ID
                const input = this.form.querySelector(`#${field}`);
                //Escucha los cambios en tiempo real (por cada tecla presionada)
                // Ejecuta el validateField por cada campo y letra pulsada
                input.addEventListener('input', () => this.validateField(input));
            });
        }


        /////////////////////////////////////////////
        //         METODO : validateForm           //
        //   Valida todos los campos al enviar     //
        ////////////////////////////////////////////

        validateForm(e) {
            // Previene el envio del formulario
            e.preventDefault();
            // pone la variable isValid a true
            let isValid = true;

            //Por cada campo comprueba si es requerido y si es requerido hace la comprobaci√≥n con el validateField y se es errorneo
            // pone la variable isValid a false
            // Para los campos marcados como requeridos: requerido=true && tiene que pasar la validacion
            // Para los campos marcados como no requerido: requerido=false && 


            /*
               1.- Object.keys(this.fields).forEach(field => {

                Object.keys(this.fields):
                  Esto obtiene un array con todas las claves del objeto this.fields.
                  En este caso, this.fields es el objeto de configuraci√≥n que contiene los campos del formulario y sus reglas de validaci√≥n.
                     Por ejemplo, si this.fields es:
                              {
                                  nombre: { pattern: '...', required: true },
                                  email: { pattern: '...', required: true },
                                  telefono: { pattern: '...', required: false }
                              }
                    Entonces, Object.keys(this.fields) devuelve:
                                  ['nombre', 'email', 'telefono']
                .forEach(field => { ... }):
                      Recorre el array de claves (nombre, email, telefono) y ejecuta la funci√≥n definida dentro del forEach para cada clave.
                      La variable field representar√° cada clave durante la iteraci√≥n.
            */

            Object.keys(this.fields).forEach(field => {

                /*
                const input = this.form.querySelector(#${field});
                  this.form:
                  Hace referencia al formulario que estamos validando. Este formulario fue capturado previamente en el constructor de la clase con:
                                this.form = document.getElementById(formId);
                  
                                querySelector(#${field}):
                  Busca un elemento dentro del formulario cuyo id coincida con el nombre de la clave actual (field).
                                Por ejemplo:
                                Si field es 'nombre', esto seleccionar√° el campo:
                                             <input id="nombre">
                El resultado es que input ser√° una referencia al elemento del DOM correspondiente.
                */

                const input = this.form.querySelector(`#${field}`);

                /*
                
                              3. if (this.fields[field].required && !this.validateField(input)) {
                              Esta l√≠nea tiene dos condiciones que se deben cumplir para ejecutar el bloque del if:
                                            Condici√≥n 1: this.fields[field].required
                                                 this.fields[field]: Accede a la configuraci√≥n del campo actual dentro del objeto fields.
                                                 .required: Comprueba si el campo est√° marcado como obligatorio.
                              
                                                 Por ejemplo:
                                                      Para el campo 'nombre':
                                                        this.fields['nombre'].required; // true
                                                      Para el campo 'telefono':
                                                          this.fields['telefono'].required; // false
                                            Solo entra al if si el campo actual es obligatorio.
                              
                                            Condici√≥n 2: !this.validateField(input)
                                                    this.validateField(input): Llama al m√©todo validateField, que valida el contenido del campo (seg√∫n las reglas definidas en fields) y devuelve true si es v√°lido o false si no lo es.
                                                       /* !this.validateField(input):
                                            Si el campo no pasa la validaci√≥n (es inv√°lido), esta condici√≥n ser√° true.
                */

                /* Campo requerido = true -- Pasa la validacion = isValid= true
                /* Campo requerido = true -- NO pasa la validaci√≥n = isValid = false
                / Campo requerido = false - isValid = true; */

                if (this.fields[field].required && !this.validateField(input)) {
                    isValid = false;
                }
            });

            // Si alguno de los campos es requerido y no es valido
            if (isValid) {
                return true;
                //  alert('Formulario v√°lido! Enviando datos...');
                //  this.form.reset(); //Limpia el formulario
                //  this.clearValidation(); //limpia las validaciones
            } else {
                return false;
            }
        }

        /////////////////////////////////////////////
        //         METODO : validateField           //
        //   Valida cada tecla de cada campo      //
        ////////////////////////////////////////////

        validateField(input) {
            //this.fields[input.id]: Busca en el objeto fields la configuraci√≥n asociada al campo que se est√° validando.
            const config = this.fields[input.id];
            //console.log('Config es', config);
            const value = input.value.trim();
            const parentDiv = input.closest('.col-7.col-sm-9');


            ////////////////////
            /// CAMPOS IMAGEN //
            ////////////////////
            //Validaci√≥n para campos de tipo imagen
            if (input.type === 'file' && config.required) {
                if (input.files.length === 0) {
                    input.classList.add('is-invalid');
                    input.classList.remove('is-valid');
                    return false;
                } else {
                    //Validar tipo de archivo
                    const file = input.files[0];
                    const fileName = file.name;
                    const fileExtension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();
                    const allowedTypes = config.fileType; // Obtener los tipos de archivo permitidos desde la configuraci√≥n
                    const maxSizeKB = config.maxSize; // Obtener el tama√±o m√°ximo desde la configuraci√≥n
                    const fileSizeKB = file.size / 1024; // Tama√±o del archivo en KB

                    if (!allowedTypes.includes(fileExtension)) {
                        input.classList.add('is-invalid');
                        input.classList.remove('is-valid');
                        return false;
                    } else if (fileSizeKB > maxSizeKB) {
                        input.classList.add('is-invalid');
                        input.classList.remove('is-valid');
                        return false;
                    } else {
                        input.classList.remove('is-invalid');
                        input.classList.add('is-valid');
                        return true;
                    }
                }
            }


            ////////////////////
            /// CAMPOS SELECT //
            ////////////////////
            // Solamente v√°lidos para los campos select // Si es un select, es requerido y el valor es "0", se considera inv√°lido
            // Si es un select, es requerido y el valor es "0", se considera inv√°lido
            // Si es un select, es requerido y el valor es "0", se considera inv√°lido
            if (input.tagName === 'SELECT' && config.required && value === '0') {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');

                return false;
            } else {
                input.classList.remove('is-invalid');
                input.classList.add('is-valid');
            }

            // Si no es obligatorio y est√° vac√≠o: v√°lido
            if (!config.required && value === '') {
                input.classList.remove('is-invalid', 'is-valid');
                parentDiv.classList.remove('has-success, has-danger');
                return true;
            }

            // Validar campo obligatorio vac√≠o
            if (config.required && value === '') {
                input.classList.add('is-invalid');
                input.classList.remove('is-valid');
                return false;
            }


            // Validar patr√≥n regex
            /*value: Es el valor actual del campo de entrada, que se obtiene con input.value.
                regex.test(value): Verifica si el valor cumple con el patr√≥n de la expresi√≥n regular:
                Retorna true si el valor cumple con el patr√≥n.
                Retorna false si no cumple.*/

            const regex = new RegExp(config.pattern);
            const isValid = regex.test(value);

            /*
            classList.toggle(): A√±ade o elimina una clase CSS del elemento, dependiendo del segundo par√°metro:
            Si el segundo par√°metro es true, la clase se a√±ade.
            Si es false, la clase se elimina.*/

            input.classList.toggle('is-invalid', !isValid);
            input.classList.toggle('is-valid', isValid);

            return isValid;
        }


        clearValidation() {
            Object.keys(this.fields).forEach(field => {
                const input = this.form.querySelector(`#${field}`);
                input.classList.remove('is-valid', 'is-invalid');
            });
        }
    }
</script>

<script src="../../public/js/bracket.js"></script>
<script src="../../public/js/tooltip-colored.js"></script>
<script src="../../public/js/popover-colored.js"></script>